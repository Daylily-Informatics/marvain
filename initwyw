#!/usr/bin/env bash
set -euo pipefail

PROFILE="${1:-}"
RGN="${2:-}"

if [[ -z "${PROFILE}" || -z "${RGN}" ]]; then
  echo "Usage: ./initwyw <AWS_PROFILE> <AWS_REGION>" >&2
  exit 2
fi

export AWS_PROFILE="${PROFILE}"
export AWS_REGION="${RGN}"
export AWS_DEFAULT_REGION="${RGN}"

# Make local imports work similarly to how Layers behave in Lambda/SAM
export PYTHONPATH="${PYTHONPATH:-}:$(pwd)/layers/config/python:$(pwd)"

if [[ ! -d ".venv" ]]; then
  echo "Creating venv at .venv"
  python3 -m venv .venv
fi

# shellcheck disable=SC1091
source .venv/bin/activate

python -m pip install --upgrade pip >/dev/null
python -m pip install -r requirements.txt >/dev/null

echo "âœ… Environment ready."
echo "AWS_PROFILE=${AWS_PROFILE}"
echo "AWS_REGION=${AWS_REGION}"
